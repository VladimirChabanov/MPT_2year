# Практическое задание 1. Организация удалённого доступа в OC Linux.

## Основные теоретические сведения

**Цель:** Ознакомиться на практике со средствами удаленного управления в операционной системе Linux. Приобрести опыт и навыки управления удаленным доступом посредством ssh.

**Теоретическая часть:**



## Задания к практической работе

Каждую выполненную вам команду и результат её работы поместите в отчёт в виде скриншота.

1. Создайте новую виртуальную машину и установите Ubuntu Server. Образ можно скачать на официальном [сайте](https://ubuntu.com/). В процессе установки можно оставить настройки по умолчанию. Инструкцию с комментариями по каждому шагу можно найти тут: https://losst.pro/ustanovka-ubuntu-server-20-04. На данный момент доступна версия 22.04 LTS, но серьёзных отличий нет:

   - В процессе создания виртуальной машины установите галочку "Пропустить автоматическую установку", для того, чтобы иметь возможность выполнить конфигурирование сервера;
   - После шага 6 в указанной выше инструкции пропущен выбор типа установки **Ubuntu Server** или **Ubuntu Server (minimized)**, второй вариант предусматривает использование в контейнерах и виртуальных машинах, не подразумевающих интерактивный вход и ручное управление. Это значит, что в такой системе отсутствуют утилиты ручного управления и если вы все-таки захотите администрировать ее руками, то вам придется развернуть ее до уровня Ubuntu Server. Поэтому здесь ничего не меняем.
   - На шаге 7 настройки сетевого подключения менять не нужно.
   - На шаге 10 можно ничего не менять, а оставить **Use an entire disk**.

2. После перезагрузки сервера залогиньтесь используя имя пользователя и пароль указанные в процессе установки.

3. Как обычно, первым делом выполните обновление индекса пакетов и обновите устаревшие: `sudo apt-get update && sudo apt-get upgrade`

4. Затем убедитесь, что ssh-сервер установлен и запущен: `systemctl status ssh`. Вывод должен быть примерно такой:  
   ![](./task_01_img/sshd_status.png)

5. Если ssh-сервер не установлен, то установите его и добавьте в автозагрузку ([подробнее](https://losst.pro/ustanovka-ssh-ubuntu-16-04)):  
   ```bash
   sudo apt install openssh-server
   sudo systemctl enable sshd
   ```

6. Прежде чем заняться настройкой ssh-подключения попробуем подключится к серверу с другой машины. Но прямо сейчас мы не сможем это сделать, т.к. VirtualBox по умолчанию для каждой виртуальной машины создаёт отдельную сеть и сама машина размещается в ней за [NAT](https://youtu.be/L1JtmAiSaFQ). Т.е. машина имеет доступ из сети наружу, а снаружи к машине никто доступ не имеет.

7. Изменим тип сетевого подключения виртуальной машины на **Сетевой мост**. Это приведёт к тому, что виртуальная машина подключится к нашему роутеру как отдельное устройство и в результате хостовая и виртуальная машины будут в одной локальной сети которую создаёт роутер.  
   Чтобы это сделать выключите сервер: `poweroff`, в окне VutrualBox откройте Настройки виртуальной машины и в разделе "Сеть" выберите [Тип подключения](https://losst.pro/nastrojka-seti-virtualbox) "Сетевой мост":  
   ![](./task_01_img/vb_net.png)

8. Заново запустите сервер и посмотрите список сетевых интерфейсов: `ip a`. Кроме интерфейса с ip-адресом 127.0.0.1 должен быть второй, соответствующий подключению к роутеру. В моём случае роутер выдал серверу такой ip:  
   ![](./task_01_img/server_ip.png)

9. Проверьте, что сервер доступен из хостовой ОС при помощи утилиты `ping` c ip адресом **своего** сервера: `ping 192.168.1.36`. Потерянных пакетов быть не должно.  
   Вообще говоря можно пропинговать и в обратную сторону, но в случае, если вы работаете на Windows 8 и старше, то настройки по умолчанию запрещают Windows отвечать на ping-запросы. При желании вы может эту блокировку [отключить](https://help.keenetic.com/hc/ru/articles/213966229-Отключение-блокировки-ответа-на-ping-запросы-в-ОС-Windows-8-10).  
   Получить список сетевых интересов в Windows можно командой `ipconfig`.

10. Теперь убедимся, что мы можем из хостовой системы подключится к серверу по ssh.  
    Если выработаете на Unix подобной ОС, то воспользуйтесь стандартной утилитой `ssh`: `ssh имя_пользователя@ip_адрес`.  
    Если вы работаете под Windows, то скачайте telnet и ssh клиент [KiTTY](https://www.fosshub.com/KiTTY.html) (можно portable, чтобы не устанавливать). Запустите её и укажите ip-адрес сервера. Порт по умолчанию для ssh соединения 22  
    ![](./task_01_img/kitty.png)

11. Если подключение будет установлено успешно, то вы увидите предупреждение, о том, что вы первый раз подключаетесь к указанному хосту и вопрос, действительно ли мы уверены, что это тот самый компьютер, к которому мы хотим подключаться. Ответьте согласием и в дальнейшем это предупреждение не будет выводится, т.к. клиент запомнит указанный хост.  
    Информация о всех известных хостах хранится в рабочем каталоге в файле `.ssh/known_hosts`. Каждый раз, когда мы подключаемся по протоколу ssh к серверу, ssh клиент проверяет совпадает ли публичный ключ для этого сервера с тем, который был прошлый раз и если это не так, то в подключении будет отказано (возможно это злые хацкеры прикидываются вашим сервером).

12. В зависимости от того при помощи какой программы вы подключались у вас запросят имя пользователя и пароль или только пароль. Если всё прошло успешно, вы должны увидеть приветственное сообщение и изменение приглашения к вводу. Теперь все ваши команды будут выполнены на сервере.

13. Завершите сеанс командой `exit`.

14. **Продолжение будет добавлено сегодня**.

## Вопросы к практическому заданию

Ответы на следующие вопросы поместите в отчёт:

  1. **Вопросы будут добавлены сегодня**.

## Отчёт

Оформите отчёт в соответствии с шаблоном и загрузите его в элемент Задание с номером работы в мудле.